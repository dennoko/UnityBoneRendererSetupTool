# Bone Renderer Setup Tool 使い方

このツールは、VRChatアバターやその衣装に対して、Animation Riggingの `Bone Renderer` コンポーネントを簡単にセットアップするためのUnity拡張機能です。
特に衣装のボーン設定において、アバターのボーン構造を参照してヒューマノイドボーンを自動的に特定し、可視化することができます。


## 事前準備：Animation Riggingのインストール

このツールを使用するには、Unity公式の **Animation Rigging** パッケージが必要です。
まだプロジェクトに導入していない場合は、以下の手順でインストールしてください。

1.  Unityエディタのメニューバーから `Window` > `Package Manager` を開きます。
2.  ウィンドウ左上の `+` ボタンの隣にあるドロップダウンメニューから **Unity Registry** を選択します。
3.  リストから **Animation Rigging** を探します（検索バーに "Animation Rigging" と入力するとすぐに見つかります）。
4.  **Install** ボタンをクリックします。

---

## 主な機能

1.  **アバターのボーン可視化設定**
    *   アバターのAnimatorコンポーネントからヒューマノイドボーンを自動検出し、BoneRendererを設定します。
2.  **衣装のボーン可視化設定（マッチング機能）**
    *   衣装のボーン名がアバターと完全一致しなくても、形状や命名規則（VRM、Blender形式など）から自動的に対応するアバターのボーンを推定し、BoneRendererを設定します。
    *   UpperChest（上胸）の有無の違いなども自動で吸収します。
3.  **カラー設定**
    *   アバター用と衣装用で、可視化するボーンの色を個別に設定できます。

---

## 使い方の手順

### 1. ツールウィンドウの表示

メニューバーから以下の項目を選択して、設定ウィンドウを開きます。

`dennokoworks` > `BoneRendererSetupTool`

### 2. カラー設定

ウィンドウ上部の「カラー設定」セクションで、ボーンの表示色を設定できます。
変更した色は保存され、次回以降のセットアップ時に自動的に適用されます。

*   **Avatar Color**: アバターのボーン表示色（デフォルト: 緑系統）
*   **Outfit Color**: 衣装のボーン表示色（デフォルト: オレンジ系統）

### 3. セットアップの実行

セットアップは「設定ウィンドウ」または「Hierarchyの右クリックメニュー」のどちらからでも実行できます。

#### 方法 A: 設定ウィンドウを使用する場合

1.  **アバターのセットアップ**
    *   Hierarchyにあるアバター（Animatorを持つGameObject）を、「アバター」欄にドラッグ&ドロップします。
    *   `Setup Avatar` ボタンを押すと、アバターにBoneRendererが追加されます。

2.  **衣装のセットアップ**
    *   「アバター」欄にアバターが設定されていることを確認します（衣装のマッチングに必要です）。
    *   Hierarchyにある衣装のルートオブジェクトを、「衣装」欄にドラッグ&ドロップします。
    *   `Setup Outfit` ボタンを押すと、衣装にBoneRendererが追加されます。

#### 方法 B: 右クリックメニューを使用する場合

1.  **アバターのセットアップ**
    *   Hierarchyでアバターを選択し、右クリックします。
    *   `GameObject` > `BoneRendererSetupTool` > `Setup (Avatar)` を選択します。
    
2.  **衣装のセットアップ**
    *   **重要**: シーン内に比較対象となるアバター（Humanoid設定済み）が存在する必要があります。
    *   Hierarchyで衣装を選択し、右クリックします。
    *   `GameObject` > `BoneRendererSetupTool` > `Setup (Outfit → Avatar)` を選択します。
    *   シーン内にアバターが複数ある場合は、どのアバターと照合するかを選択するメニューが表示されます。

---

## 各機能の詳細

### BoneRendererの削除
設定済みのBoneRendererを削除したい場合は、以下のいずれかの操作を行います。
*   ウィンドウ内の `Remove Renderer` ボタンを押す。
*   対象のオブジェクトを右クリックし、 `GameObject` > `BoneRendererSetupTool` > `Remove (Avatar)` または `Remove (Outfit)` を選択する。

### 注意事項
*   衣装のマッチング精度を上げるため、衣装のボーン構造は一般的な命名規則（例: `Hips`, `Spine`, `LeftUpperArm` や `Arm_L` など）に従っていることが望ましいです。
*   独自の名前を持つボーンの場合、自動マッチングで検出できないことがあります。
